# NeCRUD

A CRUD server for NeDB.

This is a webserver with authentication that provides CRUD operations on a collection
of NeDB databases as well as a websocket interface to listen real time for changes
made to the NeDB database collections.

The webserver includes an administrative page where collections can be created, destroyed,
and data in the collections can be manipulated.


# getting started

The server is ready to go with the default configuration, just clone the project and run
npm install to install the dependencies and start the server...

```shell
> git clone https://github.com/bnielsen1965/necrud.git
> cd necrud
> npm install
> node index.js
```

This will bring up a server with the default settings using the provided self signed
certificate. Open a web browser to the server running on the default port, I.E.

http://localhost:8880/   or   https://localhost:4443

If everything worked you should be presented with a login page after accepting the
self signed certificate.


# configuration

The config directory contains discrete configuration files for each functional aspect
of the application.

Most settings can be left as they are but there are a few settings that should be
modified for the specific install. Changes should be made to users, jwt, and webserver.
See the sections for each configuration module for details on settings.


## authentication

In most cases the authentication settings will not require adjustments.

The authentication configuration contains router settings that control which routes
are allowed by anyone, which routes are completely disallowed, and which routes
that are used for the authentication service.

**NOTE:** The authentication configuration requires the users configuration, the
jwt configuration, and the hash configuration.


## users

The users configuration is a simple array of users that can authenticate with the
database server. The password in the user element must be a hash generated by the api
hash function or blank for an empty password if necessary when setting up a user.


## jwt

The jwt configuration contains the JSON web token settings used when generating authentication
tokens for authenticated users. The key settings should be changed to a secret passphrase
to identify tokens generated by this server.


## hash

In most cases the hash settings will not require adjustments.

The hash configuration contains the settings for hashing of user passwords.


## webserver

The webserver settings define the HTTP and HTTPS ports to use as well as paths to
the HTTPS key and certificate files.

**NOTE:** The application includes a sample self signed certificate in the certs directory.


## socketserver

In most cases the socketserver settings will not require adjustments.

The socket server configuration requires the jwt settings so websocket connections
can be authorized based on the provided JSON web token.


## webapi

In most cases the webapi settings will not require adjustments.

Configuration settings for the REST api are set in the webapi configuration file.


# API

The REST api includes various endpoint routes for use and operation of the database
server as well as routes for database CRUD operations.


## POST /authentication

Accessing the CRUD api will require an authorization token that is generated through
successful authentication on the */authentication* endpoint.

POST a JSON object with the username and password to the authentication endpoint along
with appropriate headers and the response will be a JSON object with a JSON Web Token.

**Note the Accept header value of application/json that ensures the api response is a JSON object.**

Example HTTP POST
```
POST /authentication HTTP/1.1
Host: localhost:4443
Accept: application/json
Content-Type: application/json
Content-Length: 43

{
    "username": "admin", "password": ""
}
```

Response
```json
{
    "token": "eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaWF0IjoxNjA1MDYwMTA4LCJleHAiOjE2MDUxNDY1MDh9.bKesU3htJu7unk71v4uwa0XaappN1H0NWGP-1Pq1aYVV1Nkm2JnbFQwvs6zpGQrllrds0SPukdbrAZVvNEGOuQ"
}
```

The token is valid for CRUD requests until it expires. The expiration timestamp is
embedded in the token payload. See documentation on [JWTs](https://jwt.io/) for details
on how to parse and read a JWT.


## GET | POST | DELETE /api/collections

get list of database collections

create new collection

delete a collection


## GET | POST | PUT | PATCH | DELETE /db

collection CRUD operations


## POST /hash

hash a password for users list
